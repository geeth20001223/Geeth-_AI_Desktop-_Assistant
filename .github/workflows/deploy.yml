name: Deploy to Environment

on:
  push:
    branches:
      - dev
      - staging
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout Code
      - name: Checkout Code
        uses: actions/checkout@v2

      # Step 2: Setup Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Step 3: Install Dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Step 4: Setup SSH Access
      - name: Setup SSH Key
        run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > key.pem
          chmod 600 key.pem

      # Step 5: Deploy Based on Branch
      - name: Deploy to Appropriate Environment
        run: |
          echo "Current branch: ${{ github.ref }}"
          
          if [[ "${{ github.ref }}" == "refs/heads/dev" ]]; then
            echo "ðŸš€ Deploying to DEV server"
            ssh -o StrictHostKeyChecking=no -i key.pem user@DEV_SERVER_IP "cd /path/to/dev/app && git pull && systemctl restart your-app-service"

          elif [[ "${{ github.ref }}" == "refs/heads/staging" ]]; then
            echo "ðŸš€ Deploying to STAGING server"
            ssh -o StrictHostKeyChecking=no -i key.pem user@STAGING_SERVER_IP "cd /path/to/staging/app && git pull && systemctl restart your-app-service"

          elif [[ "${{ github.ref }}" == "refs/heads/main" ]]; then
            echo "ðŸš€ Deploying to PRODUCTION server"
            ssh -o StrictHostKeyChecking=no -i key.pem user@PROD_SERVER_IP "cd /path/to/prod/app && git pull && systemctl restart your-app-service"
